<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: src/storymode.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: src/storymode.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>
/** 
  * @module storymode 
  */

// PixiJS convenience aliases 
window.Sprite = PIXI.Sprite;
window.AnimatedSprite = PIXI.AnimatedSprite;
window.Point = PIXI.Point;
window.Rectangle = PIXI.Rectangle;
window.Text = PIXI.Text
window.Graphics = PIXI.Graphics
window.Container = PIXI.Container;
window.Texture = PIXI.Texture;
window.loader = PIXI.Loader.shared;
window.resources = loader.resources;
window.ticker = PIXI.Ticker.shared;

const appEmitter = new PIXI.utils.EventEmitter(); 

import * as _ext from './utils/extensions.js';

import * as utils from './utils/utils.js';
import * as mutils from './utils/mutils.js';

import Scene from './core/scene.js';

import * as nav from './core/nav.js';
import * as scaler from './core/scaler.js';
import * as ui from './core/ui.js';

import KB from './utils/kb.js';
const kb = new KB();

import SFX from './utils/sfx.js';
let sfx = new SFX();;

import physics from './utils/physics.js';

import * as store from './utils/store.js';

// Props 
let pixiApp; // PIXI app instance
let isProd = process.env.NODE_ENV != 'development';  // Set in package.json: eg. "start:dev": "webpack serve --mode development"
let htmlEle; // The element containing the game

// Load all transitions
let filters = {};
const _filters = utils.requireAll(require.context('./utils/filters', false, /.js$/));
for (let _filter of _filters) {
  filters[_filter.id] = _filter.default;
}

/**
 * Called after initial assets are loaded.
 *
 * @callback AppLoadCallback
 * @param {PIXI.Application} pixiApp The PIXI Application 
 */
 
/**
 * Creates a new PIXI Application, wrapper for `new PIXI.Application(...)`.
 * &lt;br>- Ideally the main app script is included in the body immediately after the container HTML element is included. In this scenario the app will be created instantly.
 * &lt;br>- Otherwise if the app script is initialised before the container HTML element is attached to the DOM then it will load in the background before continuing.
 * @param {string} htmlEleID - The DOM element ID in which to add the Pixi canvas. If not present yet will wait for it to arrive.
 * @param {boolean} [fullScreen=false] - If true will base the canvas dimensions on the window size rather than the containing element.
 * @param {Object} [pixiOptions=null] - Option object to override defaults sent to PIXI. See: {@link http://pixijs.download/release/docs/PIXI.Application.html#Application}
 * @param {AppLoadCallback} [onLoadCallback=null] - Called after initial assets are loaded.
 */
export function createApp(_htmlEleID, fullScreen = false, pixiOptions = null, onLoadCallback = null) {
    
  let setupConfig = {};
  setupConfig.htmlEleID = _htmlEleID;
  setupConfig.onLoadCallback = onLoadCallback;

  sfx.loadPrefs()
          
  let defaultOptions = {  
      autoDensity: true, //  Adjusts the canvas using css pixels so it will scale properly (it was the default behavior in v4)
      antialias: window.devicePixelRatio == 1, // Only anti alias from non-retina displays
      backgroundAlpha: 1.0,
      resolution: window.devicePixelRatio, // Resolution controls scaling of content (sprites, etc.)         
      backgroundColor: 0x000000,
      clearBeforeRender: true // This sets if the renderer will clear the canvas or not before the new render pass.
  }

  if (!pixiOptions){
    pixiOptions = {};
  }
  pixiOptions = utils.extend(defaultOptions, pixiOptions);

  // Is the html ele attached to the DOM at this point?
  if (utils.e(setupConfig.htmlEleID) &amp;&amp; typeof utils.e(setupConfig.htmlEleID)['appendChild'] === 'function'){
    htmlEle = utils.e(setupConfig.htmlEleID);
  }

  // Apply resize target now if element already exists.
  // - Otherwise wait until setup to apply target.
  if (fullScreen){
    // Window is present even if containing DOM element is not at this point.
    pixiOptions.resizeTo = window; 
  } else if (htmlEle){
    pixiOptions.resizeTo = htmlEle;
  } 

  setupConfig.pixiOptions = utils.cloneObj(pixiOptions); // A copy is retained for setup.

  // Docs: http://pixijs.download/release/docs/PIXI.Application.html#Application
  pixiApp = new PIXI.Application(pixiOptions);

  ui.autoloadAssets(()=>{
    setup(setupConfig);
  });
    
}


let fpsAvg;
// All assets are loaded by this point and the stage is empty
function setup(setupConfig){ 
  
  if (!utils.e(setupConfig.htmlEleID) || typeof utils.e(setupConfig.htmlEleID)['appendChild'] !== 'function'){
    
    // The container element needs to be present and able to appendChild.
    utils.wait(1.0/5.0, setup, [setupConfig]);
    return;
  
  }
  
  // DOM is attached by this point.
  
  if (!htmlEle){
    htmlEle = utils.e(setupConfig.htmlEleID);
  }
  
  if (!setupConfig.pixiOptions.resizeTo){ // Will already be set if fullscreen
    pixiApp.resizeTo = htmlEle; 
  }
  
  pixiApp.render(); 
  scaler.setup();
  
  // Attach canvas to the DOM 
  htmlEle.appendChild(pixiApp.view);

  // Attach core display objects 
  nav.setupStage(pixiApp.stage, setupConfig.pixiOptions.backgroundAlpha);
  
  // Debug TF
  if (isProd){
    // Disable right click - this menu may be confusing to user
    htmlEle.setAttribute('oncontextmenu', 'return false');
  } else {
    const debugTf = new PIXI.Text('X', {fontFamily : 'Arial', fontSize: 13, fill : 0xffffff, align : 'left', dropShadow: true,
    dropShadowColor: '#000000',
    dropShadowBlur: 0.0,
    dropShadowDistance: 2.0});  
    debugTf.x = 3.0;
    debugTf.y = 3.0 + 50.0;    
    debugTf.alpha = 0.5;
    pixiApp.stage.addChild(debugTf);
    fpsAvg = -1;    
    ticker.add(function(time){
        fpsAvg = fpsAvg &lt; 0 ? PIXI.Ticker.shared.FPS : fpsAvg*0.8 + PIXI.Ticker.shared.FPS*0.2;
        debugTf.text = fpsAvg.toFixed(1);
    }); 
  }
  
  // Get default scene and load it
  if (!nav.openDefaultScene()){
    throw new Error('Default scene not found.')
  }
  
  // Post setup 

  if (setupConfig.onLoadCallback){
    setupConfig.onLoadCallback(pixiApp);
  }

  appEmitter.emit('ready', pixiApp.stage)

  sfx._enableLoad(); 
  
} 

export {pixiApp, filters, htmlEle}; // Internal access to these properties.
export {appEmitter}; // Emitter events
export {kb, sfx, store, physics} // Helpers 
export {utils, mutils,nav, ui, scaler, Scene}; // Core 

</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Modules</h3><ul><li><a href="module-mutils.html">mutils</a></li><li><a href="module-nav.html">nav</a></li><li><a href="module-scaler.html">scaler</a></li><li><a href="module-store.html">store</a></li><li><a href="module-storymode.html">storymode</a></li><li><a href="module-ui.html">ui</a></li><li><a href="module-utils.html">utils</a></li></ul><h3>Namespaces</h3><ul><li><a href="physics.html">physics</a></li><li><a href="PIXI.html">PIXI</a></li></ul><h3>Classes</h3><ul><li><a href="-_PhysicsNotes.html">_PhysicsNotes</a></li><li><a href="-_PsdConfiguration.html">_PsdConfiguration</a></li><li><a href="-_Snippets.html">_Snippets</a></li><li><a href="-_Subclassing.html">_Subclassing</a></li><li><a href="-_WindowScope.html">_WindowScope</a></li><li><a href="kb.html">kb</a></li><li><a href="module-nav.FadeTrans.html">FadeTrans</a></li><li><a href="module-nav.MarioTrans.html">MarioTrans</a></li><li><a href="module-nav.OverTrans.html">OverTrans</a></li><li><a href="module-nav.PanTrans.html">PanTrans</a></li><li><a href="module-nav.PixelateTrans.html">PixelateTrans</a></li><li><a href="module-scaler-ArtboardProjection.html">ArtboardProjection</a></li><li><a href="physics.jgsap.html">jgsap</a></li><li><a href="physics.JRender.html">JRender</a></li><li><a href="physics.JRunner.html">JRunner</a></li><li><a href="physics.JSyncLink.html">JSyncLink</a></li><li><a href="physics.JWireframeRender.html">JWireframeRender</a></li><li><a href="PIXI.AnimatedSprite.html">AnimatedSprite</a></li><li><a href="PIXI.DisplayObject.html">DisplayObject</a></li><li><a href="PIXI.Graphics.html">Graphics</a></li><li><a href="PIXI.Texture.html">Texture</a></li><li><a href="Scene.html">Scene</a></li><li><a href="SFX.html">SFX</a></li></ul><h3>Events</h3><ul><li><a href="module-scaler.html#event:fullscreenchange">fullscreenchange</a></li><li><a href="module-scaler.html#event:resize">resize</a></li><li><a href="module-scaler.html#event:resize_immediate">resize_immediate</a></li><li><a href="SFX.html#event:bgloop_enabled_change">bgloop_enabled_change</a></li><li><a href="SFX.html#event:bgready">bgready</a></li><li><a href="SFX.html#event:sfx_enabled_change">sfx_enabled_change</a></li><li><a href="SFX.html#event:sfxready">sfxready</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 3.6.10</a> on Fri Jun 17 2022 09:33:58 GMT+1000 (Australian Eastern Standard Time)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
